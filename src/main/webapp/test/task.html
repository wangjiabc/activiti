<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta content="" name="description"/>
    <meta content="webthemez" name="author"/>
<link rel='stylesheet' type='text/css' href='../css/style.css'>
<script type='text/javascript' src="../js/jquery.js"></script>
    <title>泸州信息</title>
</head>


                    <form  id="userinfo-form">
                        <div class="row">
                            <div class="form-group col-sm-3">
                                <label class="col-sm-4 control-label">姓名</label>
                                <div class="col-sm-8">
                                    <input type="text" class="form-control required" name="username"
                                           id="username" placeholder="">
                                </div>
                            </div>
						</div>
						<div class="row">
                            <div class="form-group col-sm-3">
                                <label class="col-sm-4 control-label">年龄</label>
                                <div class="col-sm-8">
                                    <input type="text" class="form-control required" name="age"
                                           id="age" placeholder="">
                                </div>
                            </div>
						</div>
					</form>

		<div class="form-group">
            <div class="col-sm-5">
                <button class="mybtn mybtn-medium mybtn-green w100" id="submit" onclick="addInfo();">保存</button>
                <button class="mybtn mybtn-medium mybtn-green w100" type="button" onclick="history.back();" class="btn">返回</button>
            </div>
        </div>
					
<script type="text/javascript">	

	function getQueryString(name) {
    	var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
    	var r = window.location.search.substr(1).match(reg);
    	console.log(r);
    	if (r != null) return unescape(r[2]); return null;
   	}

	var taskId=getQueryString("taskId");
	console.log(taskId);
	
	 $.ajax({
         type: "post",
         async: false,
         url: "../flow/findMyTaskById.do",
         data: {
        	 id:taskId
         	}

         ,
         success: function (data) {
            console.log(data.vacation.age);
            $("#username").val(data.vacation.uname);
            $("#age").val(data.vacation.age);
         }
     })
	
	
	function addInfo() {
        var clientInfo = new Object();

        clientInfo.username = $("#username").val().toString();
        clientInfo.age = $("#age").val().toString();
        
        var clientInfodata = JSON.stringify(clientInfo);
        $.ajax({
            type: "post",
            async: false,
            url: "../flow/personalTask.do",
            data: {
            	
            	variableData: clientInfodata,
            	className:"test1",
            	taskId:taskId
            	}

            ,
            success: function (data) {
            	console.log(data);
                if (data.state == "failed") {
                    alert("error");
                    return false;
                } else {
   
                       alert("添加成功");
                       history.go(-2);
                    	
                	}
            }
        })

        
	}
</script>